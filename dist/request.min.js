!function(a){"undefined"!=typeof module&&module.exports?module.exports=a():this.EventStation=a()}(function(){function a(){}function b(a,b){return this.channels=this.channels||{},(this.channels[a]=this.channels[a]||[]).push(b),this}function c(a,b){if(a)if(b){if(a=this.channels[a]){var c=a.indexOf(b);~c&&a.splice(c,1)}}else this.channels[a]=[];else this.channels={};return this}function d(a,b){return b=[].slice(arguments,1),a=this.channels[a],a&&a.forEach(function(a){a.apply(this,b)},this),this}function e(a,d){function e(){c.call(this,a,e),d.apply(this,arguments)}return b.call(this,a,e),this}function f(a,b){return a=this.channels[a]?b?!!~a.indexOf(b):!0:!1}a.mixin=a.extend=function(a){for(var b in g)a[b]=g[b];return a};var g=a.prototype={};return g.on=g.listen=g.addListener=g.addEventListener=b,g.off=g.unListen=g.removeListener=g.removeEventListener=c,g.broadcast=g.emit=g.fire=d,g.once=e,g.hasListener=f,a});var request=function(a){return a()}(function(){function a(a,b){var c=new Error(b);return c.type=a,c}function b(){var a=window||this;if(a.XMLHttpRequest&&("file:"!=a.location.protocol||!a.ActiveXObject))return new XMLHttpRequest;try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(b){}try{return new ActiveXObject("Msxml2.XMLHTTP.6.0")}catch(b){}try{return new ActiveXObject("Msxml2.XMLHTTP.3.0")}catch(b){}try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(b){}return null}function c(){}function d(a,b){for(var c in b)a[c]=b[c];return a}function e(a){var b={};return a.split("&").forEach(function(a){var c=a.split("=");b[decodeURIComponent(c[0])]=decodeURIComponent(c[1])}),b}function f(a){var b=[];for(var c in a)b.push(encodeURIComponent(c)+"="+encodeURIComponent(a[c]));return b.join("&")}function g(a,b){this.headers={},this.query={},this.data=null,this.form=null,this.method=a,this.url=b}function h(a,b){this.channels={},this.options=new g(a,b)}function i(a,b){var c=b.http,d=status/100|0;a.status=c.status,a.statusType=d,a.info=1==d,a.ok=2==d,a.clientError=4==d,a.serverError=5==d,a.error=4==d||5==d?new Error("Cannot "+b.options.method+" "+b.options.url+" "+status):!1,a.created=201==status,a.accepted=202==status,a.noContent=204==status||1223==status,a.badRequest=400==status,a.unauthorized=401==status,a.notAcceptable=406==status,a.notFound=404==status,a.forbidden=403==status,a.internalServerError=500==status}function j(a){var b=a.http.getAllResponseHeaders(),c=b.split(/\r?\n/),d={};return c.pop(),c.forEach(function(a){var b=a.indexOf(":"),c=a.slice(0,b).toLowerCase();d[c]=a.slice(b+1).trim()}),d["Content-Type"]=a.http.getResponseHeader("content-type"),d}function k(a,b){switch(a){case"application/x-www-form-urlencoded":return e(b);case"application/json":return JSON.parse(b);default:return b}}function l(a){var b=a.http;this.text=b.responseText,i(this,a),this.headers=j(a),this.body="HEAD"!=a.method?k(this.headers["Content-Type"],b.responseText):null}function request(a,b){switch(!0){case!b:return new h("GET",a);case"function"==typeof b:return new h("GET",a).end(b);default:return new h(a,b)}}var m=["get","post","put","head","delete","options","trace","copy","lock","mkcol","move","propfind","proppatch","unlock","report","mkactivity","checkout","merge","m-search","notify","subscribe","unsubscribe","patch"],n={};return n.html=n.text="text/html",n.json="application/json",n.xml="application/xml",n.urlencoded=n.form=n.url=n["form-data"]="application/x-www-form-urlencoded","".trim||(String.prototype.trim=function(){return this.replace(/(^\s*|\s*$)/g,"")}),[].forEach||(Array.prototype.forEach=function(a,b){for(var c=-1,d=this.length;++c<d;)a.call(b,this[c],c,this)}),g.prototype={},g.prototype.createBody=function(){var a=this.form||this.data,b={}.toString.call(a);switch(!0){case"GET"==this.method:case"HEAD"==this.method:case"string"==typeof a:case"[object File]"==b:case"[object Blob]"==b:case"[object FormData]"==b:return a}switch(this.getHeader("Content-Type")){case"application/x-www-form-urlencoded":return f(a);case"application/json":return JSON.stringify(a)}return a},g.prototype.prepare=function(){var a=b(),c=f(this.query),d=this.method,e=this.url,g=this.headers;c&&(e+=~e.indexOf("?")?"&"+c:"?"+c),this.withCredentials&&(a.withCredentials=!0),this.user&&this.password?a.open(d,e,!0,this.user,this.password):a.open(d,this.url,!0);for(var h in g)g[h]&&a.setRequestHeader(h,g[h]);return a},g.prototype.attach=function(a,b,c){this.form=this.form||new FormData,this.form.append(a,b,c)},g.prototype.addData=function(a,b){this.data=this.data||{},void 0==b?this.headers[a]=b:"string"!=typeof a&&d(this.data,a)},g.prototype.getHeader=function(a){return this.headers[a]},g.prototype.setHeader=function(a,b){void 0==b?this.headers[a]=b:"string"!=typeof a&&d(this.headers,a)},g.prototype.addQuery=function(a,b){void 0==b?this.query[a]=b:"string"!=typeof a&&d(this.headers,a)},g.prototype.setUser=function(a,b){this.user=a,this.password=b},h.prototype={},h.prototype.auth=function(a,b){return this.header("Authorization","Basic"+btoa(a+":"+b)),this},h.prototype.user=function(a,b){return this.options.setUser(a,b),this},h.prototype.header=function(a,b){return this.options.setHeader(a,b),this},h.prototype.query=function(a,b){return this.options.addQuery(a,b),this},h.prototype.contentType=function(a){return a=n[a]||a,this.header("Content-Type",a),this},h.prototype.accept=function(a){return this.header("Accept",a),this},h.prototype.origin=function(a){return this.header("Origin",a),this},h.prototype.withCredentials=function(){return this.options.withCredentials=!0,this},h.prototype.attach=function(a,b,c){return this.options.attach(a,b,c),this},h.prototype.send=function(a,b){return this.options.getHeader("Content-Type")||this.contentType("json"),this.options.addData(a,b),this},h.prototype.abort=function(){return this.aborted?this:(this.aborted=!0,this.http.abort(),this.broadcast("abort"),this)},h.prototype.timeout=function(a){return this.timeoutTime=a,this},h.prototype.end=function(b){b=b||c;var d,e=this,f=this.options,g=f.prepare(),h=this.timeoutTime;return this.http=g,g.onreadystatechange=function(){4==g.readyState&&(0==g.status?b(e.aborted?a("timeout","Connection timed out"):a("crossDomain","Origin is not allowed by Access-Control-Allow-Origin")):e.broadcast("end"))},g.upload&&(g.upload.onprogress=function(a){a.percent=a.loaded/a.total*100,e.broadcast("progress",a)}),e.on("abort",function(){clearTimeout(d)}),e.on("end",function(){clearTimeout(d),b(null,new l(this))}),h&&(d=setTimeout(function(){e.abort()},f.timeout)),this.broadcast("send"),g.send(f.createBody()),this},l.prototype={body:null,header:function(a){return this.headers[a]}},m.forEach(function(a){var b="delete"==a?"del":a;a=a.toUpperCase(),request[b]=function(b,c){var d=request(a,b);return c&&d.end(c),d}}),request});
!function(a){"undefined"!=typeof module&&module.exports?module.exports=a():this.EventStation=a()}(function(){function a(){}function b(a,b){return this.channels=this.channels||{},(this.channels[a]=this.channels[a]||[]).push(b),this}function c(a,b){if(a)if(b){if(a=this.channels[a]){var c=a.indexOf(b);~c&&a.splice(c,1)}}else this.channels[a]=[];else this.channels={};return this}function d(a,b){return b=[].slice(arguments,1),a=this.channels[a],a&&a.forEach(function(a){a.apply(this,b)},this),this}function e(a,d){function e(){c.call(this,a,e),d.apply(this,arguments)}return b.call(this,a,e),this}function f(a,b){return a=this.channels[a]?b?!!~a.indexOf(b):!0:!1}a.mixin=a.extend=function(a){for(var b in g)a[b]=g[b];return a};var g=a.prototype={};return g.on=g.listen=g.addListener=g.addEventListener=b,g.off=g.unListen=g.removeListener=g.removeEventListener=c,g.broadcast=g.emit=g.fire=d,g.once=e,g.hasListener=f,a});var request=function(a){return a(EventStation)}(function(a){function b(a,b){var c=new Error(b);return c.type=a,c}function c(a){var b=window||this,c=null;if(!b.XMLHttpRequest||"file:"==b.location.protocol&&b.ActiveXObject)if(a)"undefined"!=typeof b.XDomainRequest&&(c=new b.XDomainRequest);else{try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(d){}try{return new ActiveXObject("Msxml2.XMLHTTP.6.0")}catch(d){}try{return new ActiveXObject("Msxml2.XMLHTTP.3.0")}catch(d){}try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(d){}}else c=new XMLHttpRequest,!a||"withCredentials"in c||(c=null);return c}function d(){}function e(a,b){for(var c in b)a[c]=b[c];return a}function f(a){var b={};return a.split("&").forEach(function(a){var c=a.split("=");b[decodeURIComponent(c[0])]=decodeURIComponent(c[1])}),b}function g(a){var b=[];for(var c in a)b.push(encodeURIComponent(c)+"="+encodeURIComponent(a[c]));return b.join("&")}function h(a,b){this.headers={},this.query={},this.data=null,this.form=null,this.method=a,this.url=b}function i(a,b){this.channels={},this.options=new h(a,b)}function j(a,b){var c=b.http,d=c.status,e=d/100|0;a.status=c.status,a.statusType=e,a.info=1==e,a.ok=2==e,a.clientError=4==e,a.serverError=5==e,a.error=4==e||5==e?new Error("Cannot "+b.options.method+" "+b.options.url+" "+d):!1,a.created=201==d,a.accepted=202==d,a.noContent=204==d||1223==d,a.badRequest=400==d,a.unauthorized=401==d,a.notAcceptable=406==d,a.notFound=404==d,a.forbidden=403==d,a.internalServerError=500==d}function k(a){var b=a.http.getAllResponseHeaders(),c=b.split(/\r?\n/),d={};return c.pop(),c.forEach(function(a){var b=a.indexOf(":"),c=a.slice(0,b).toLowerCase();d[c]=a.slice(b+1).trim()}),d["content-type"]=a.http.getResponseHeader("content-type"),d}function l(a,b){switch(a){case"application/x-www-form-urlencoded":return f(b);case"application/json":return JSON.parse(b);default:return b}}function m(a){var b=a.toLowerCase(),c=parseInt(a),d=parseFloat(a);switch(!0){case"true"==b:return!0;case"false"==b:return!1;case"null"==b:return null;case!isNaN(d):return d;case!isNaN(c):return c;default:return a}}function n(a){var b=this,c=a.http;this.text=c.responseText,j(this,a),this.headers=k(a),this.header("Content-Type").split(/\s*;\s*/).forEach(function(a){var c=a.split(/\s*=\s*/);c[1]?b[c[0]]=c[1]:b.contentType=c[0]}),this.body="HEAD"!=a.method?l(this.headers["Content-Type"],c.responseText):null}function request(a,b){switch(!0){case!b:return new i("GET",a);case"function"==typeof b:return new i("GET",a).end(b);default:return new i(a,b)}}var o=["get","post","put","head","delete","options","trace","copy","lock","mkcol","move","propfind","proppatch","unlock","report","mkactivity","checkout","merge","m-search","notify","subscribe","unsubscribe","patch"],p={};return p.html=p.text="text/html",p.json="application/json",p.xml="application/xml",p.urlencoded=p.form=p.url=p["form-data"]="application/x-www-form-urlencoded","".trim||(String.prototype.trim=function(){return this.replace(/(^\s*|\s*$)/g,"")}),[].forEach||(Array.prototype.forEach=function(a,b){for(var c=-1,d=this.length;++c<d;)a.call(b,this[c],c,this)}),h.prototype={},h.prototype.createBody=function(){var a=this.form||this.data,b={}.toString.call(a);switch(!0){case"GET"==this.method:case"HEAD"==this.method:case"string"==typeof a:case"[object File]"==b:case"[object Blob]"==b:case"[object FormData]"==b:return a}switch(this.getHeader("Content-Type")){case"application/x-www-form-urlencoded":return g(a);case"application/json":return JSON.stringify(a)}return a},h.prototype.prepare=function(){var a=c(this.cors),b=g(this.query),d=this.method,e=this.url,f=this.headers;b&&(e+=~e.indexOf("?")?"&"+b:"?"+b),this.withCredentials&&(a.withCredentials=!0),this.user&&this.password?a.open(d,e,!0,this.user,this.password):a.open(d,this.url,!0);for(var h in f)f[h]&&a.setRequestHeader(h,f[h]);return a},h.prototype.attach=function(a,b,c){this.form=this.form||new FormData,this.form.append(a,b,c)},h.prototype.addData=function(a,b){this.data=this.data||{},void 0!=b?this.headers[a]=b:"string"!=typeof a&&e(this.data,a)},h.prototype.getHeader=function(a){return this.headers[a]},h.prototype.setHeader=function(a,b){void 0!=b?this.headers[a]=b:"string"!=typeof a&&e(this.headers,a)},h.prototype.addQuery=function(a,b){void 0!=b?this.query[a]=b:"string"!=typeof a&&e(this.headers,a)},h.prototype.setUser=function(a,b){this.user=a,this.password=b},i.prototype={},a.mixin(i.prototype),i.prototype.auth=function(a,b){return this.header("Authorization","Basic"+btoa(a+":"+b)),this},i.prototype.user=function(a,b){return this.options.setUser(a,b),this},i.prototype.header=function(a,b){return this.options.setHeader(a,b),this},i.prototype.query=function(a,b){return this.options.addQuery(a,b),this},i.prototype.contentType=function(a){return a=p[a]||a,this.header("Content-Type",a),this},i.prototype.accept=function(a){return this.header("Accept",a),this},i.prototype.withCredentials=function(){return this.options.withCredentials=!0,this},i.prototype.attach=function(a,b,c){return this.options.attach(a,b,c),this},i.prototype.send=function(a,b){return this.options.getHeader("Content-Type")||this.contentType("json"),this.options.addData(a,b),this},i.prototype.abort=function(){return this.aborted?this:(this.aborted=!0,this.http.abort(),this.broadcast("abort"),this)},i.prototype.timeout=function(a){return this.timeoutTime=a,this},i.prototype.cors=function(){return this.options.cors=!0,this},i.prototype.end=function(a){a=a||d;var c,e=this,f=this.options,g=f.prepare(),h=this.timeoutTime;return this.http=g,this.options.cors&&!g?(a(b("cors","Cross Origin requests are not supported")),this):(g.onreadystatechange=function(){4==g.readyState&&(0==g.status?a(e.aborted?b("timeout","Connection timed out"):b("crossDomain","Origin is not allowed by Access-Control-Allow-Origin")):e.broadcast("end"))},g.upload&&(g.upload.onprogress=function(a){a.percent=a.loaded/a.total*100,e.broadcast("progress",a)}),e.on("abort",function(){clearTimeout(c)}),e.on("end",function(){clearTimeout(c),a(null,new n(this))}),h&&(c=setTimeout(function(){e.abort()},f.timeout)),this.broadcast("send"),g.send(f.createBody()),this)},n.prototype={body:null,header:function(a){return this.headers[a.toLowerCase()]},headerParams:function(a){var b=this.header(a);if(!b)return null;var c={};return b.split(/\s*[;,]\s*/).forEach(function(a){var b=a.split(/\s*=\s*/),d=b[0],e=b[1];c[d]=e?m(e):!0}),c}},o.forEach(function(a){var b="delete"==a?"del":a;a=a.toUpperCase(),request[b]=function(b,c){var d=request(a,b);return c&&d.end(c),d}}),request});